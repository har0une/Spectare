<% 
  card_bg_color = "#010508ff"
  font_color = "#f2f2f2"
  border_color = "rgba(255, 255, 255, 0.15)"
  border_hover_color = "rgba(255, 255, 255, 0.3)"
%>

<style>
  .card-container {
    color: <%= font_color %>;
    max-width: 900px;
    margin: 2rem auto;
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 2rem;
    font-family: sans-serif;
  }
  .left-column, .right-column {
    background-color: <%= card_bg_color %>;
    border: 2px solid <%= border_color %>;
    border-radius: 8px;
    padding: 1rem;
    transition: border-color 0.3s ease;
  }
  .left-column:hover, .right-column:hover {
    border-color: <%= border_hover_color %>;
  }
  img.poster {
    width: 100%;
    border-radius: 8px;
    margin-bottom: 1rem;
  }
  h1 {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
  }
  h2 {
    margin-top: 0;
  }
  .overview, .trailer, .cast {
    margin-bottom: 2rem;
  }
  .cast-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 1rem;
  }
  .cast-member {
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 0.5rem;
    border-radius: 6px;
  }
  .cast-member:hover {
    border-color: rgba(255, 255, 255, 0.25);
  }
  .cast-member img {
    width: 100%;
    border-radius: 6px;
    margin-bottom: 0.5rem;
  }
  .no-image {
    width: 100%;
    height: 278px;
    background: #ccc;
    border-radius: 6px;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #555;
  }
  a {
    color: #70a1ff;
    text-decoration: underline;
  }
  a:hover {
    color: #4a6cd4;
  }
</style>

<div class="card-container">

  <!-- Left column -->
  <div class="left-column">
    <% if @movie["poster_path"].present? %>
      <img class="poster" src="https://image.tmdb.org/t/p/w500<%= @movie['poster_path'] %>" alt="<%= @movie['title'] %> poster">
    <% end %>

    <h1><%= @movie["title"] %></h1>

    <p><strong>Release Date:</strong> <%= @movie["release_date"] %></p>
    <p><strong>Runtime:</strong> <%= @movie["runtime"] %> minutes</p>
    <p><strong>Rating:</strong> <%= @movie["vote_average"] %> / 10 (<%= @movie["vote_count"] %> votes)</p>

    <p><strong>Genres:</strong>
      <%= @movie["genres"].map { |g| g["name"] }.join(", ") if @movie["genres"].present? %>
    </p>

    <p><strong>Status:</strong> <%= @movie["status"] %></p>
    <p><strong>Budget:</strong> $<%= number_with_delimiter(@movie["budget"]) %></p>
    <p><strong>Revenue:</strong> $<%= number_with_delimiter(@movie["revenue"]) %></p>

    <p><strong>Official Website:</strong>
      <% if @movie["homepage"].present? %>
        <a href="<%= @movie["homepage"] %>" target="_blank" rel="noopener noreferrer"><%= @movie["homepage"] %></a>
      <% else %>
        N/A
      <% end %>
    </p>

    <p><strong>Spoken Languages:</strong>
      <%= @movie["spoken_languages"].map { |l| l["english_name"] }.join(", ") if @movie["spoken_languages"].present? %>
    </p>

    <h3>Director(s):</h3>
    <% if @directors.any? %>
      <ul>
        <% @directors.each do |director| %>
          <li><%= director["name"] %></li>
        <% end %>
      </ul>
    <% else %>
      <p>No director info found.</p>
    <% end %>

    <!-- Watchlist -->
    <div class="mb-2">
      <% if user_signed_in? %>
        <% if current_user.watchlists.exists?(movie_id: @movie["id"]) %>
          <%= button_to remove_from_watchlist_profile_path(movie_id: @movie["id"]),
                method: :delete,
                class: "btn btn-outline-warning btn-sm d-flex align-items-center gap-1" do %>
            <i class="bi bi-bookmark-fill"></i> Remove Watchlist
          <% end %>
        <% else %>
          <%= button_to add_to_watchlist_profile_path(movie_id: @movie["id"]),
                method: :post,
                class: "btn btn-outline-info btn-sm d-flex align-items-center gap-1" do %>
            <i class="bi bi-bookmark"></i> Add Watchlist
          <% end %>
        <% end %>
      <% else %>
        <%= link_to new_user_session_path,
              class: "btn btn-outline-info btn-sm d-flex align-items-center gap-1" do %>
          <i class="bi bi-bookmark"></i> Sign in to Save
        <% end %>
      <% end %>
    </div>

    <!-- Like -->
    <div class="mb-2">
      <% if user_signed_in? %>
        <% if current_user.likes.exists?(movie_id: @movie["id"]) %>
          <%= button_to remove_from_favorites_profile_path(movie_id: @movie["id"]),
                method: :delete,
                class: "btn btn-outline-danger btn-sm d-flex align-items-center gap-1" do %>
            <i class="bi bi-hand-thumbs-up-fill"></i> Unlike
          <% end %>
        <% else %>
          <%= button_to add_to_favorites_profile_path(movie_id: @movie["id"]),
                method: :post,
                class: "btn btn-outline-success btn-sm d-flex align-items-center gap-1" do %>
            <i class="bi bi-hand-thumbs-up"></i> Like
          <% end %>
        <% end %>
      <% else %>
        <%= link_to new_user_session_path,
              class: "btn btn-outline-success btn-sm d-flex align-items-center gap-1" do %>
          <i class="bi bi-hand-thumbs-up"></i> Sign in to Like
        <% end %>
      <% end %>
    </div>

    <!-- Rate -->
    <div class="mb-2">
      <%= link_to new_profile_rating_path(movie_id: @movie["id"]),
            class: "btn btn-outline-warning btn-sm d-flex align-items-center gap-1" do %>
        <i class="bi bi-star"></i> Rate Movie
      <% end %>
    </div>

  </div>

  <!-- Right column -->
  <div class="right-column">

    <div class="overview">
      <h2>Overview</h2>
      <p><%= @movie["overview"] %></p>
      <% if @movie["tagline"].present? %>
        <p style="font-style: italic; color: gray;">"<%= @movie["tagline"] %>"</p>
      <% end %>
    </div>

    <% trailer = @videos.find { |v| v["type"] == "Trailer" && v["site"] == "YouTube" } %>
    <% if trailer %>
      <div class="trailer">
        <h2>Trailer</h2>
        <div id="trailer-container"
             style="position: relative; padding-bottom: 56.25%; height: 0; cursor: pointer;"
             onclick="loadTrailer()">
          <img src="https://img.youtube.com/vi/<%= trailer['key'] %>/hqdefault.jpg"
               style="width:100%; position:absolute;">
          <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:60px;">â–¶</div>
        </div>
      </div>

      <script>
        function loadTrailer() {
          var c = document.getElementById('trailer-container');
          c.innerHTML = '<iframe src="https://www.youtube.com/embed/<%= trailer["key"] %>?autoplay=1" frameborder="0" allowfullscreen style="width:100%;height:100%;position:absolute;"></iframe>';
        }
      </script>
    <% end %>

    <div class="cast">
      <h2>Top Cast</h2>
      <div class="cast-grid">
        <% @cast.each do |actor| %>
          <div class="cast-member">
            <% if actor["profile_path"].present? %>
              <img src="https://image.tmdb.org/t/p/w185<%= actor['profile_path'] %>">
            <% else %>
              <div class="no-image">No Image</div>
            <% end %>
            <strong><%= actor["name"] %></strong>
            <p><em><%= actor["character"] %></em></p>
          </div>
        <% end %>
      </div>
    </div>

  </div>
</div>






